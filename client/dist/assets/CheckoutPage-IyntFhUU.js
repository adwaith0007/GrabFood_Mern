import{u as F,r as o,j as e,i as j,_ as T,a as P,q as I,w as E}from"./index-JMqGIfVs.js";import{A as $,U as O,C as q}from"./UpdateAddressInput-WSXkMUNL.js";const B=({orderCartItem:m,onPlaceOrder:h})=>{const{user:n}=F(a=>a.userReducer),d=n._id,i="https://www.grabfood.life",[r,c]=o.useState([]),[x,g]=o.useState(""),[s,p]=o.useState(),[u,b]=o.useState(0),[v,C]=o.useState(!0);o.useEffect(()=>{(async()=>{try{const l=await j.get(`/cart/${d}`);c(l.data.cart),m(l.data.cart)}catch(l){console.error("Error fetching cart items:",l)}finally{C(!1)}})()},[d]);const k=async a=>{a.preventDefault();try{const l=await j.post("/coupon/apply",{couponCode:x});l.data.success?p(l.data.discount):T.error(l.data.message)}catch(l){console.error("Error applying coupon:",l)}};o.useEffect(()=>{if(s!=null){const a=parseFloat(s);if(isNaN(a))console.log("Invalid discount value:",s);else{const A=r.reduce((N,D)=>N+D.price*D.quantity,0)*a/100;b(A)}}else b(0)},[s]);const w=r.reduce((a,l)=>a+l.price*l.quantity,0)-u,S=r.reduce((a,l)=>a+l.price*l.quantity,0),t=(w*.02).toFixed(2),f=15,y=(parseFloat(w.toString())+parseFloat(t)+parseFloat(f.toString())).toFixed(2);return e.jsxs("div",{className:"px-4 pt-8 relative ",children:[e.jsx("p",{className:"text-xl font-medium",children:"Order Summary "}),e.jsx("p",{className:"text-gray-400",children:"Check your items. And select a suitable shipping method."}),e.jsx("div",{className:"mt-8 space-y-3 max-h-[220px]  overflow-auto   rounded-lg border bg-white px-2 py-4 sm:px-6 custom-scrollbar",children:v?e.jsx("p",{children:"Loading..."}):r.map(a=>{var l;return e.jsxs("div",{className:"flex flex-col rounded-lg bg-white sm:flex-row",children:[e.jsx("img",{className:"m-2 h-24 w-28 rounded-md border object-cover object-center",src:`${i}/${(l=a.productImage[0])==null?void 0:l.replace(/ /g,"%20")}`,alt:a.name}),e.jsxs("div",{className:"flex w-full flex-col px-4 py-4",children:[e.jsx("span",{className:"font-semibold",children:a.productName}),e.jsxs("span",{className:"float-right text-gray-400",children:["Qua: ",a.quantity," "]}),e.jsxs("p",{className:"text-lg font-bold",children:["₹",a.price.toFixed(2)]})]})]},a._id)})}),e.jsxs("form",{onSubmit:k,className:"py-5",children:[e.jsx("label",{htmlFor:"promo",className:"font-semibold inline-block mb-3 text-sm uppercase",children:"Coupon Code"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",id:"promo",value:x,onChange:a=>g(a.target.value),placeholder:"Enter your code",className:"p-2 text-sm border-2  w-full"}),e.jsx("button",{type:"submit",className:"bg-red-500 hover:bg-red-600 px-5 py-2 text-sm text-white uppercase",children:"Apply"})]})]}),e.jsxs("div",{className:"w-full  flex flex-col items-end ",children:[s&&e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between  gap-3 text-sm uppercase",children:[e.jsx("span",{children:"discount"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",u,"-"]})})]})}),e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between  gap-3 text-sm uppercase",children:[e.jsx("span",{children:"Delivery"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",f,"+"]})})]})}),e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between gap-3 text-sm uppercase",children:[e.jsx("span",{children:"Tax"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",t,"+"]})})]})})]}),e.jsx("div",{className:"border-t mt-3",children:e.jsxs("div",{className:"flex font-semibold justify-between py-6 text-sm uppercase",children:[e.jsx("span",{children:"Total cost"}),e.jsxs("span",{children:["₹",y]})]})}),e.jsx("button",{onClick:()=>h(y,u,x,t,f,S),className:"   bottom-0  w-full rounded-md bg-gray-900 px-6 py-3 font-medium text-white",children:"Place Order"})]})},_=()=>{const[m,h]=o.useState([]);o.useEffect(()=>{(async()=>{try{const c=await j.get("/coupon/get");console.log(c.data.data),h(c.data.data)}catch(c){console.error(c)}})()},[]);const n=r=>{navigator.clipboard.writeText(r),console.log("Coupon code copied to clipboard:",r)},[d,i]=o.useState(-1);return e.jsx("div",{children:m.length>0&&m.map((r,c)=>e.jsx("div",{className:"container mx-auto   ",children:e.jsxs("div",{className:"bg-gradient-to-br mb-5 from-purple-600 to-indigo-600 text-white text-center py-7 px-20 rounded-lg shadow-md relative",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[r.discount,"%   ",r.couponName]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx("span",{id:"cpnCode",className:"border-dashed border text-white px-4 py-2 rounded-l ",children:r.couponCode}),e.jsx("span",{id:"cpnBtn",className:`  md:w-40  px-4 py-2 rounded-r cursor-pointer ${d===c?"bg-black":"bg-white  text-purple-600 border-white border "}  `,onClick:()=>{n(r.couponCode),i(c),setTimeout(()=>i(-1),1500)},children:d===c?"Copied":"Copy Code"})]}),e.jsxs("p",{className:"text-sm",children:["Valid Till: ",r.formattedDateTime]}),e.jsx("div",{className:"w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 left-0 -ml-6"}),e.jsx("div",{className:"w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 right-0 -mr-6"})]})},c))})},L=()=>{const m=P(),{user:h}=F(t=>t.userReducer),n=h._id,[d,i]=o.useState(!1),[r,c]=o.useState(!1),[x,g]=o.useState(!1),[s,p]=o.useState(),[u,b]=o.useState();o.useEffect(()=>{n&&j.get(`/user/${n}/addresses`).then(t=>{p(t==null?void 0:t.data[0])}).catch(t=>{console.error(t)})},[n]);const v=()=>{n&&j.get(`/user/${n}/addresses`).then(t=>{p(t.data[0])}).catch(t=>{console.error(t)})};console.log(s);const C=t=>{p(t)},k=t=>{p(t)},w=t=>{b(t)},S=async(t,f,y,a,l,A)=>{if(console.log("total",t),!n||!u||!s||!s.street){T.error("Please fill in all required fields.");return}try{m("/payment",{state:{checkoutData:{userId:n,products:u,address:s,discountAmount:f,couponCode:y,subTotal:A,shipping:l,tax:a,totalPrice:t}}})}catch(N){T.error("Failed to place order. Please try again later."),console.error("Error placing order:",N)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center border-b bg-white py-4 sm:flex-row sm:px-10 lg:px-20 xl:px-32",children:[e.jsx("a",{href:"#",className:"text-2xl font-bold text-gray-800",children:"checkout"}),e.jsx("div",{className:"mt-4 py-2 text-xs sm:mt-0 sm:ml-auto sm:text-base",children:e.jsx("div",{className:"relative",children:e.jsxs("ul",{className:"relative flex w-full items-center justify-between space-x-2 sm:space-x-4",children:[e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-emerald-200 text-xs font-semibold text-emerald-700",href:"#",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Shop"})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})}),e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gray-600 text-xs font-semibold text-white ring ring-gray-600 ring-offset-2",href:"#",children:"2"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Shipping"})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})}),e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gray-400 text-xs font-semibold text-white",href:"#",children:"3"}),e.jsx("span",{className:"font-semibold text-gray-500",children:"Payment"})]})]})})})]}),e.jsxs("div",{className:"grid  sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32",children:[e.jsxs("div",{className:"px-4 pt-5",children:[e.jsxs("div",{className:"flex justify-between  ",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s!=null?e.jsx(I,{icon:E,style:{color:"#63E6BE"}}):e.jsx(I,{icon:E,beat:!0,style:{color:"#63E6BE"}}),e.jsx("p",{className:"text-xl font-medium",children:"Address"})]}),e.jsxs("div",{className:"mt-4 mr-2 ",children:[e.jsx("button",{onClick:()=>{i(!d)},className:"bg-indigo-500 font-semibold hover:bg-indigo-600 py-3 px-5 text-sm text-white uppercase w-full",children:"+ address"}),d?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",d&&e.jsx($,{userId:n,setAddress:v,onClose:()=>{i(!1)}})]})]}),e.jsx("p",{className:"text-gray-400",children:"select your address or add a new address."}),e.jsx("div",{className:"mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-6",children:s!=null&&s!="no_address"?e.jsxs("div",{className:"flex justify-between   ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 ",children:[e.jsx(I,{icon:E}),e.jsx("h3",{className:"text-[#093bc9] font-semibold ",children:s==null?void 0:s.city})]}),e.jsxs("div",{className:" w-[300px]",children:[e.jsx("p",{children:s==null?void 0:s.street}),e.jsx("p",{children:`${s==null?void 0:s.state} - ${s==null?void 0:s.zipCode} `})]}),e.jsx("button",{onClick:()=>{c(!d)},className:"text-[#094fc9] font-normal mt-3",children:"Edit address"}),r?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",r&&e.jsx(O,{userId:n,currentAddress:s,onhandleUpdateAddress:C,onClose:()=>{c(!1)}})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{g(!x)},className:"text-[#093bc9] font-medium",children:"Choose another address"})}),x?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",x&&e.jsx(q,{onClose:()=>{g(!1)},onAddressSelect:k})]}):e.jsx("p",{className:"text-red-500",children:"add a new address"})}),e.jsx("div",{className:"mt-8 space-y-3 max-h-[250px] overflow-auto rounded-lg border bg-white px-2 py-4 sm:px-6 custom-scrollbar",children:e.jsx(_,{})})]}),e.jsx(B,{onPlaceOrder:S,orderCartItem:w})]})]})};export{L as default};
