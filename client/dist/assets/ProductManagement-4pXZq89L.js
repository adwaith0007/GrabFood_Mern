import{m as M,r as c,a as _,j as t,o as A,p as B,i,_ as r}from"./index-gIIwSxQ2.js";const H="https://www.grabfood.life",X=()=>{const{id:l}=M(),[e,n]=c.useState({}),[u,x]=c.useState([]),[N,w]=c.useState(!0),[b,j]=c.useState(null),[m,g]=c.useState(!1),[y,p]=c.useState(!1),[I,C]=c.useState(0),[P,E]=c.useState([]),[h,v]=c.useState(!1),S=_();c.useEffect(()=>{(async()=>{try{const a=await i.get("/category/get");a.data.success&&E(a.data.data)}catch(a){r.error("Error while loading categories"),console.error(a)}})()},[]),c.useEffect(()=>{(async()=>{try{const a=await i.get(`/product/${l}`);a.data.success?n(a.data.data):j(a.data.message||"Failed to fetch product details")}catch{j("Error fetching product details")}finally{w(!1)}})()},[l]);const F=s=>{x(a=>[...a,s])},$=s=>{x(a=>{const o=[...a];return o.splice(s,1),o})},O=async s=>{try{const a=[...e.productImage],o=a.splice(s,1)[0];n(f=>({...f,productImage:a}));const d=await i.delete(`/product/deleteImage/${l}`,{data:{imageName:o}});d.data.success?r.success("Image deleted successfully!"):(r.error(d.data.message||"Failed to delete image"),n(f=>({...f,productImage:[...a,o]})))}catch(a){console.error("Error deleting image",a),r.error("Failed to delete image")}},k=async s=>{s.preventDefault();try{g(!0);const a=new FormData;a.append("name",e.productName),a.append("price",String(e.price)),a.append("category",e.category),a.append("offer",String(I)),e.productImage.forEach(d=>{a.append("images",d)}),u.forEach(d=>{a.append("images",d)});const o=await i.put(`/product/update/${l}`,a);o.data.success?(n(o.data.data.updatedProduct),r.success(o.data.message),p(!1)):r.error(o.data.message||"Failed to update Product")}catch(a){r.error(a.response.data.message)}finally{g(!1)}},L=async()=>{try{(await i.put(`/product/softDelete/${l}`)).data.success?(n(a=>({...a,deleted:!a.deleted})),r.success(`Product ${e.deleted?"restored":"soft deleted"} successfully!`)):r.error("Failed to delete Product")}catch(s){console.error("Error deleting Product",s),r.error("Failed to delete Product")}},R=async()=>{try{(await i.delete(`/product/delete/${l}`)).status===200?(r.success("Product deleted successfully"),S("/admin/product")):r.error("Failed to delete product")}catch(s){console.error("Error deleting product",s),r.error("Failed to delete product")}},U=async()=>{try{g(!0);const s={...e,discountPrice:null};n(s);const a=new FormData;a.append("name",s.productName),a.append("price",String(s.price)),a.append("category",s.category),a.append("offer","0"),s.productImage.forEach(d=>{a.append("images",d)}),u.forEach(d=>{a.append("images",d)});const o=await i.put(`/product/update/${l}`,a);o.data.success?(n(o.data.data.updatedProduct),r.success("Offer canceled successfully"),p(!1)):r.error(o.data.message||"Failed to cancel offer")}catch{r.error("Failed to cancel offer")}finally{g(!1)}};return N?t.jsx("div",{children:"Loading..."}):b?t.jsxs("div",{children:["Error: ",b]}):t.jsxs("div",{children:[h&&t.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),t.jsxs("main",{className:"product-management",children:[t.jsxs("section",{children:[t.jsxs("strong",{children:["ID - ",e==null?void 0:e._id]}),(e==null?void 0:e.productImage)&&e.productImage.length>0&&t.jsx("div",{className:"w-full form-group",children:t.jsx("div",{className:"w-full grid grid-cols-3 border-2 rounded-xl shadow p-3 gap-4 mt-1",children:e.productImage.map((s,a)=>t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:`${H}/${s}`,alt:`Existing ${a}`,className:"w-full h-32 object-cover rounded-md"}),t.jsx("button",{type:"button",className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-300",onClick:()=>O(a),children:"X"})]},a))})}),u.length>0&&t.jsx("div",{className:"form-group",children:t.jsx("div",{className:"grid grid-cols-3 gap-4 mt-1",children:u.map((s,a)=>t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:URL.createObjectURL(s),alt:`Preview ${a}`,className:"w-full h-32 object-cover rounded-md"}),t.jsx("button",{type:"button",className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-300",onClick:()=>$(a),children:"X"})]},a))})}),t.jsx("p",{children:e==null?void 0:e.productName}),(e==null?void 0:e.discountPrice)<(e==null?void 0:e.price)&&(e!=null&&e.discountPrice)?t.jsxs("p",{children:[t.jsxs("span",{className:"text-3xl font-semibold text-slate-900",children:["₹",e==null?void 0:e.discountPrice]}),t.jsxs("span",{className:"text-sm text-slate-900 line-through",children:["₹",e==null?void 0:e.price]})]}):t.jsx("p",{children:t.jsxs("span",{className:"text-3xl font-bold text-slate-900",children:["₹",e==null?void 0:e.price]})})]}),t.jsxs("article",{children:[t.jsx("button",{className:"product-delete-btn",onClick:R,disabled:m,children:t.jsx(A,{})}),t.jsxs("form",{onSubmit:k,children:[t.jsx("h2",{children:"Manage"}),t.jsxs("div",{children:[t.jsx("label",{children:"Name"}),t.jsx("input",{type:"text",value:e==null?void 0:e.productName,onChange:s=>n({...e,productName:s.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Price"}),t.jsx("input",{type:"number",value:e==null?void 0:e.price,onChange:s=>n({...e,price:s.target.value})})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"category",children:"Category"}),t.jsxs("select",{name:"category",id:"category",value:e==null?void 0:e.category,onChange:s=>n({...e,category:s.target.value}),className:"min-w-[180px] w-[20vw] border border-teal-700 rounded-xl p-2 text-sm",children:[t.jsx("option",{value:"",children:e==null?void 0:e.category}),P.map((s,a)=>t.jsx("option",{value:s.category,children:s.category},a))]})]}),t.jsxs("div",{className:"flex w-full",children:[t.jsx("div",{children:(e==null?void 0:e.discountPrice)<(e==null?void 0:e.price)&&(e!=null&&e.discountPrice)?t.jsx("button",{type:"button",onClick:U,className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Cancel Offer"}):t.jsx("button",{type:"button",onClick:()=>{p(!y)},className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Add Offer"})}),y&&(e==null?void 0:e.discountPrice)&&t.jsx("div",{children:t.jsx("input",{onChange:s=>C(parseInt(s.target.value,10)),className:"w-52",placeholder:"Offer in percentage..",type:"number"})})]}),t.jsxs("div",{className:"form-group flex gap-5",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("button",{type:"button",className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",onClick:()=>{v(!h)},children:"Upload Images"})}),t.jsx("div",{className:"flex items-center",children:t.jsx("button",{type:"button",className:`py-2 px-4 cursor-pointer ${e!=null&&e.deleted?"bg-red-500 text-white":"bg-green-500 text-white"}`,onClick:L,disabled:m,children:e!=null&&e.deleted?"Undo Delete":"Soft Delete"})})]}),t.jsx("button",{type:"submit",disabled:m,children:"Update"})]})]})]}),h&&t.jsx("div",{className:"",children:t.jsx(B,{onClose:()=>v(!1),handleImageChange:F,aspectRatio:5/4,maxImage:4})})]})};export{X as default};
