import{k,r as o,a as A,j as t,A as L,l as P,i as u,_ as a}from"./index-SuGLVXXj.js";const R="https://www.grabfood.life",M=()=>{var y,j;const{id:p}=k(),[e,d]=o.useState(),[c,C]=o.useState(),[v,w]=o.useState(!0),[f,F]=o.useState(!1),[N,S]=o.useState(0),[m,n]=o.useState(null),[h,x]=o.useState(!1),E=A();o.useEffect(()=>{(async()=>{try{const r=await u.get(`/Category/${p}`);r.data.success?d(r.data.data):n(r.data.message||"Failed to fetch Category details")}catch{n("Error fetching Category details")}finally{w(!1)}})()},[p]);const I=`${R}/${(j=(y=e==null?void 0:e.categoryImage)==null?void 0:y[0])==null?void 0:j.replace(/ /g,"%20")}`,$=s=>{var g;const r=(g=s.target.files)==null?void 0:g[0];r&&C(r)},U=async s=>{s.preventDefault(),x(!0);try{if((e==null?void 0:e.category.trim().length)<5){a.error("Category name should contain a minimum of 5 letters");return}if(/\d/.test(e==null?void 0:e.category)){a.error("Category name should not contain numbers");return}if(/[!@#$%^&*(),.?":{}|<>]/.test(e==null?void 0:e.category)){a.error("Category name should not contain special characters");return}const l=new FormData;l.append("category",(e==null?void 0:e.category)||""),l.append("offer",String(N)),c&&l.append("photo",c);const b=e==null?void 0:e._id;console.log("Updating category with ID:",b);const i=(await u.put(`/category/update/${b}`,l)).data;console.log("Response from backend:",i),i.success?(a.success("Category updated successfully!"),d(i.data)):a.error(i.message||"Failed to update Category")}catch(r){r.response&&r.response.data&&r.response.data.message?a.error(r.response.data.message):a.error("Failed to update Category. Please try again later.")}finally{x(!1)}},O=async()=>{try{if((await u.put(`/category/softDelete/${e._id}`)).data.success){const r={...e,deleted:!e.deleted};d(r)}else console.error("Error deleting category"),n("Failed to delete category"),a.error("Failed to delete category")}catch(s){console.error("Error deleting category",s),n("Failed to delete category"),a.error("Failed to delete category")}},_=async()=>{if(window.confirm("Are you sure you want to delete this category?"))try{(await u.delete(`/category/delete/${e._id}`)).status===200?(a.success("Category deleted successfully"),E("/admin/category")):(console.error("Error deleting category"),n("Failed to delete category"),a.error("Failed to delete category"))}catch(r){console.error("Error deleting category",r),n("Failed to delete category"),a.error("Failed to delete category")}};return v?t.jsx("div",{children:"Loading..."}):m?t.jsxs("div",{children:["Error: ",m]}):t.jsxs("div",{className:"admin-container",children:[t.jsx(L,{}),t.jsxs("main",{className:"product-management",children:[t.jsxs("section",{children:[t.jsxs("strong",{children:["ID - ",e==null?void 0:e._id]}),t.jsx("img",{src:I,alt:"Category"}),t.jsx("p",{children:e==null?void 0:e.category})]}),t.jsxs("article",{children:[t.jsx("button",{className:"product-delete-btn",onClick:_,disabled:h,children:t.jsx(P,{})}),t.jsxs("form",{onSubmit:U,children:[t.jsx("h2",{children:"Manage"}),t.jsxs("div",{children:[t.jsx("label",{children:"Category"}),t.jsx("input",{type:"text",value:e==null?void 0:e.category,onChange:s=>d({...e,category:s.target.value})})]}),t.jsxs("div",{className:"form-group flex gap-2 ",children:[t.jsx("label",{children:"Photo"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"imageInput",className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Upload Images"}),t.jsx("input",{type:"file",id:"imageInput",accept:"image/*",className:"hidden",onChange:$})]}),t.jsx("div",{className:"flex items-center",children:t.jsx("button",{className:`px-2 py-1 cursor-pointer ${e!=null&&e.deleted?"bg-red-500 text-white":"bg-green-500 text-white"}`,onClick:O,children:e!=null&&e.deleted?"Undo Deleted":"Soft Delete"})})]}),c&&t.jsx("img",{src:URL.createObjectURL(c),alt:"New Image"}),t.jsxs("div",{className:"flex w-full ",children:[t.jsx("div",{children:t.jsx("button",{type:"button",onClick:()=>{F(!f)},className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Add Offer"})}),f&&t.jsx("div",{children:t.jsx("input",{onChange:s=>S(parseInt(s.target.value,10)),className:"w-52",placeholder:"Offen in percentage..",type:"number"})})]}),t.jsx("button",{type:"submit",disabled:h,children:"Update"})]})]})]})]})};export{M as default};
