import{m as R,r as o,a as A,j as t,o as B,p as H,i as c,_ as r}from"./index-73V7kQ1A.js";const V="https://www.grabfood.life",q=()=>{var j,C;const{id:f}=R(),[e,n]=o.useState(null),[l,F]=o.useState(),[I,S]=o.useState(!0),[g,$]=o.useState(!1),[O,_]=o.useState(0),[p,m]=o.useState(null),[i,h]=o.useState(!1),[y,x]=o.useState(!1),b=A();o.useEffect(()=>{(async()=>{try{const s=await c.get(`/Category/${f}`);s.data.success?n(s.data.data):m(s.data.message||"Failed to fetch category details")}catch{m("Error fetching category details")}finally{S(!1)}})()},[f]);const P=`${V}/${(C=(j=e==null?void 0:e.categoryImage)==null?void 0:j[0])==null?void 0:C.replace(/ /g,"%20")}`,E=a=>{F(a)},U=async a=>{var s,w;if(a.preventDefault(),!!e){h(!0);try{if(e.category.trim().length<5){r.error("Category name should contain a minimum of 5 letters");return}if(/\d/.test(e.category)){r.error("Category name should not contain numbers");return}if(/[!@#$%^&*(),.?":{}|<>]/.test(e.category)){r.error("Category name should not contain special characters");return}const d=new FormData;d.append("category",e.category),d.append("offer",String(O)),l&&d.append("photo",l);const u=(await c.put(`/category/update/${e._id}`,d)).data;u.success?(r.success("Category updated successfully!"),n(u.data),b("/admin/category")):r.error(u.message||"Failed to update category")}catch(N){const v=((w=(s=N.response)==null?void 0:s.data)==null?void 0:w.message)||"Failed to update category. Please try again later.";r.error(v)}finally{h(!1)}}},k=async()=>{if(e){console.log("categoryDetails.id",e._id);try{(await c.put(`/category/update/${e._id}`,{offer:0,category:e.category})).data.success?(n(s=>s&&{...s,offerInPercentage:0}),r.success("Offer canceled successfully")):r.error("Failed to cancel offer")}catch{r.error("Failed to cancel offer")}}},M=async()=>{if(e)try{(await c.put(`/category/softDelete/${e._id}`)).data.success?(n(s=>s&&{...s,deleted:!s.deleted}),r.success(`Category ${e.deleted?"restored":"soft deleted"} successfully`)):r.error("Failed to delete category")}catch{r.error("Failed to delete category")}},L=async()=>{if(!e)return;if(window.confirm("Are you sure you want to delete this category?"))try{(await c.delete(`/category/delete/${e._id}`)).status===200?(r.success("Category deleted successfully"),b("/admin/category")):r.error("Failed to delete category")}catch{r.error("Failed to delete category")}};return I?t.jsx("div",{children:"Loading..."}):p?t.jsxs("div",{children:["Error: ",p]}):t.jsxs("main",{className:"product-management",children:[y&&t.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),t.jsxs("section",{children:[t.jsxs("strong",{children:["ID - ",e==null?void 0:e._id]}),t.jsx("img",{src:P,alt:"Category"}),t.jsx("p",{children:e==null?void 0:e.category})]}),t.jsxs("article",{children:[t.jsx("button",{className:"product-delete-btn",onClick:L,disabled:i,children:t.jsx(B,{})}),t.jsxs("form",{onSubmit:U,children:[t.jsx("h2",{children:"Manage"}),t.jsxs("div",{children:[t.jsx("label",{children:"Category"}),t.jsx("input",{type:"text",value:(e==null?void 0:e.category)||"",onChange:a=>n(s=>s&&{...s,category:a.target.value})})]}),t.jsxs("div",{className:"form-group w-full flex gap-2",children:[t.jsx("label",{children:"Photo"}),t.jsx("div",{className:"flex items-center w-full ",children:t.jsx("button",{type:"button",className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",onClick:()=>x(!0),children:"Upload Images"})}),t.jsx("div",{className:"flex items-center w-full ",children:t.jsx("button",{type:"button",className:`px-4 py-2 cursor-pointer w-full rounded ${e!=null&&e.deleted?"bg-red-500 text-white":"bg-green-500 text-white"}`,onClick:M,disabled:i,children:e!=null&&e.deleted?"Undo Deleted":"Soft Delete"})})]}),l&&t.jsx("img",{src:URL.createObjectURL(l),alt:"New Image"}),t.jsxs("div",{className:"flex w-full",children:[e!=null&&e.offerInPercentage?t.jsxs("button",{type:"button",onClick:k,className:"cursor-pointer w-full bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 transition-all duration-300",children:["Cancel ",e==null?void 0:e.offerInPercentage,"% Offer"]}):t.jsx("div",{className:"w-full",children:t.jsx("button",{type:"button",onClick:()=>$(!g),className:"cursor-pointer w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-all duration-300",children:"Add Offer"})}),g&&t.jsx("div",{children:t.jsx("input",{type:"number",className:"w-52",placeholder:"Offer in percentage...",onChange:a=>_(parseInt(a.target.value,10))})})]}),t.jsx("button",{type:"submit",disabled:i,children:"Update"})]})]}),y&&t.jsx("div",{className:"",children:t.jsx(H,{onClose:()=>x(!1),handleImageChange:E,aspectRatio:1/1,maxImage:1})})]})};export{q as default};
