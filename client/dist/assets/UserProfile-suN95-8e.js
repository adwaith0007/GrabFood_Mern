import{u as $,a as U,b as z,r,i as y,_ as i,f as M,h as L,y as A,z as F,j as s,S as u,M as _,A as V,B as Z,p as B}from"./index-e2YNa8fC.js";const O="https://www.grabfood.life",q=()=>{const{user:n}=$(e=>e.userReducer),o=n==null?void 0:n._id,g=U(),c=z(),[w,x]=r.useState(!0),[d,f]=r.useState(!1),[p,b]=r.useState(!1),[h,j]=r.useState(null),[a,m]=r.useState({name:"",gender:"",email:"",phoneNumber:"",profileImage:""}),N=r.useCallback(async()=>{x(!0);try{const e=await y.get(`/user/get/${o}`);if(e&&e.data){const t=e.data.data;m({name:t.username,gender:t.gender,email:t.email,phoneNumber:t.phone,profileImage:t.profilePicture})}}catch(e){console.error("Error fetching user data:",e),i.error(e.response.data.message),e.response.data.message==="User is blocked"&&(M.remove("token"),c(L()),g("/login"))}finally{x(!1)}},[o,g,c]);r.useEffect(()=>{N()},[N]);const v=r.useCallback(e=>{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return i.error("Invalid email format. Please enter a valid email address."),!1;const[l,S]=e.split("@");return/^\d+$/.test(l)?(i.error("Invalid email. Local part of the email cannot be numeric."),!1):/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(S)?!0:(i.error("Invalid email domain. Please enter a valid domain."),!1)},[]),I=r.useCallback(e=>{const t=/^[0-9]{10}$/,l=/^(\d)\1{9}$/;return t.test(e)?l.test(e)?(i.error("Invalid Phone Number. Phone number should not contain consecutive identical digits."),!1):!0:(i.error("Invalid Phone Number. Please enter a 10-digit number without any spaces or special characters."),!1)},[]),k=r.useCallback(()=>{f(!0)},[]),P=r.useCallback(async()=>{if(v(a.email)&&I(a.phoneNumber))try{const e=new FormData;e.append("name",a==null?void 0:a.name),e.append("gender",a==null?void 0:a.gender),e.append("email",a==null?void 0:a.email),e.append("phoneNumber",a==null?void 0:a.phoneNumber),h&&e.append("profileImage",h);const t=await y.put(`/user/edit/${o}`,e,{headers:{"Content-Type":"multipart/form-data"}});t.status===200?(console.log("User profile updated successfully"),m(l=>({...l,profileImage:t.data.data.profilePicture})),c(A(t.data.data.profilePicture))):console.error("Error updating user profile"),f(!1)}catch(e){console.error("Error updating user profile:",e)}},[a,h,o,v,I,c]),C=r.useCallback((e,t)=>{if(e==="profileImage"){const l=t[0];j(l)}else m(l=>({...l,[e]:t}))},[]),E=r.useCallback(e=>{j(e),m(t=>({...t,profileImage:URL.createObjectURL(e)}))},[]),R=r.useMemo(()=>typeof a.profileImage=="string"?a.profileImage.startsWith("blob:")?a.profileImage:`${O}/${a.profileImage.replace(/ /g,"%20")}`:F,[a.profileImage]);return s.jsxs("div",{className:"h-full",children:[p&&s.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),s.jsx("div",{className:"container flex flex-col items-center h-full mx-auto p-6 bg-white rounded-md shadow-md",children:s.jsx("div",{className:"flex flex-col justify-center items-center border-2 rounded-[10px] shadow w-[350px] h-[450px] mt-5",children:w?s.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[s.jsx(u,{circle:!0,height:128,width:128}),s.jsx(u,{height:30,width:200,className:"mt-6"}),s.jsx(u,{height:20,width:250,className:"mt-4"}),s.jsx(u,{height:20,width:250,className:"mt-2"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"relative w-32 h-32",children:s.jsx("img",{src:R,alt:"user",className:"w-full h-full object-cover rounded-full"})}),d&&s.jsx("button",{onClick:()=>b(!p),className:"p-1 bg-blue-500 text-white rounded-full",children:"Change Image"}),s.jsx("div",{children:s.jsx("div",{className:"font-semibold text-lg",children:n==null?void 0:n.name})})]}),s.jsxs("div",{className:"mt-6 flex flex-col justify-center items-center",children:[s.jsx("div",{className:"flex items-center mb-4",children:d?s.jsx("input",{type:"email",value:a==null?void 0:a.email,onChange:e=>C("email",e.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"Email"}):s.jsx("span",{children:a==null?void 0:a.email})}),s.jsx("div",{className:"flex w-full justify-center items-center mb-4",children:d?s.jsx("input",{type:"tel",value:a==null?void 0:a.phoneNumber,onChange:e=>C("phoneNumber",e.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",placeholder:"Phone Number"}):s.jsx("span",{children:a==null?void 0:a.phoneNumber})})]}),s.jsx("div",{className:"flex items-center justify-between mt-10",children:d?s.jsxs("div",{className:"flex justify-center items-center gap-10",children:[s.jsxs("button",{onClick:P,className:"text-green-500 hover:underline cursor-pointer",children:[s.jsx(V,{size:20,className:"inline-block mb-1"}),"Save"]}),s.jsxs("button",{onClick:()=>f(!1),className:"text-red-500 hover:underline cursor-pointer",children:[s.jsx(Z,{size:20,className:"inline-block mb-1"}),"Cancel"]})]}):s.jsxs("button",{onClick:k,className:"text-blue-500 hover:underline cursor-pointer",children:[s.jsx(_,{size:20,className:"inline-block mb-1"}),"Edit Profile"]})})]})})}),p&&s.jsx(B,{onClose:()=>b(!1),handleImageChange:E,aspectRatio:1/1,maxImage:1})]})};export{q as default};
