import{m as P,r as o,a as R,j as e,o as A,p as B,i as d,_ as a}from"./index-e2YNa8fC.js";const H="https://www.grabfood.life",T=()=>{var j,C;const{id:g}=P(),[t,n]=o.useState(null),[c,S]=o.useState(),[F,I]=o.useState(!0),[f,$]=o.useState(!1),[E,O]=o.useState(0),[m,p]=o.useState(null),[i,h]=o.useState(!1),[x,y]=o.useState(!1),b=R();o.useEffect(()=>{(async()=>{try{const s=await d.get(`/Category/${g}`);s.data.success?n(s.data.data):p(s.data.message||"Failed to fetch category details")}catch{p("Error fetching category details")}finally{I(!1)}})()},[g]);const U=`${H}/${(C=(j=t==null?void 0:t.categoryImage)==null?void 0:j[0])==null?void 0:C.replace(/ /g,"%20")}`,_=r=>{S(r)},M=async r=>{var s,w;if(r.preventDefault(),!!t){h(!0);try{if(t.category.trim().length<5){a.error("Category name should contain a minimum of 5 letters");return}if(/\d/.test(t.category)){a.error("Category name should not contain numbers");return}if(/[!@#$%^&*(),.?":{}|<>]/.test(t.category)){a.error("Category name should not contain special characters");return}const l=new FormData;l.append("category",t.category),l.append("offer",String(E)),c&&l.append("photo",c);const u=(await d.put(`/category/update/${t._id}`,l)).data;u.success?(a.success("Category updated successfully!"),n(u.data),b("/admin/category")):a.error(u.message||"Failed to update category")}catch(N){const v=((w=(s=N.response)==null?void 0:s.data)==null?void 0:w.message)||"Failed to update category. Please try again later.";a.error(v)}finally{h(!1)}}},k=async()=>{if(t)try{(await d.put(`/category/softDelete/${t._id}`)).data.success?(n(s=>s&&{...s,deleted:!s.deleted}),a.success(`Category ${t.deleted?"restored":"soft deleted"} successfully`)):a.error("Failed to delete category")}catch{a.error("Failed to delete category")}},L=async()=>{if(!t)return;if(window.confirm("Are you sure you want to delete this category?"))try{(await d.delete(`/category/delete/${t._id}`)).status===200?(a.success("Category deleted successfully"),b("/admin/category")):a.error("Failed to delete category")}catch{a.error("Failed to delete category")}};return F?e.jsx("div",{children:"Loading..."}):m?e.jsxs("div",{children:["Error: ",m]}):e.jsxs("main",{className:"product-management",children:[x&&e.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),e.jsxs("section",{children:[e.jsxs("strong",{children:["ID - ",t==null?void 0:t._id]}),e.jsx("img",{src:U,alt:"Category"}),e.jsx("p",{children:t==null?void 0:t.category})]}),e.jsxs("article",{children:[e.jsx("button",{className:"product-delete-btn",onClick:L,disabled:i,children:e.jsx(A,{})}),e.jsxs("form",{onSubmit:M,children:[e.jsx("h2",{children:"Manage"}),e.jsxs("div",{children:[e.jsx("label",{children:"Category"}),e.jsx("input",{type:"text",value:(t==null?void 0:t.category)||"",onChange:r=>n(s=>s&&{...s,category:r.target.value})})]}),e.jsxs("div",{className:"form-group flex gap-2",children:[e.jsx("label",{children:"Photo"}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{type:"button",className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",onClick:()=>y(!0),children:"Upload Images"})}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{type:"button",className:`px-2 py-1 cursor-pointer ${t!=null&&t.deleted?"bg-red-500 text-white":"bg-green-500 text-white"}`,onClick:k,disabled:i,children:t!=null&&t.deleted?"Undo Deleted":"Soft Delete"})})]}),c&&e.jsx("img",{src:URL.createObjectURL(c),alt:"New Image"}),e.jsxs("div",{className:"flex w-full",children:[e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>$(!f),className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Add Offer"})}),f&&e.jsx("div",{children:e.jsx("input",{type:"number",className:"w-52",placeholder:"Offer in percentage...",onChange:r=>O(parseInt(r.target.value,10))})})]}),e.jsx("button",{type:"submit",disabled:i,children:"Update"})]})]}),x&&e.jsx("div",{className:"",children:e.jsx(B,{onClose:()=>y(!1),handleImageChange:_,aspectRatio:1/1,maxImage:1})})]})};export{T as default};
