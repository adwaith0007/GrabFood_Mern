import{j as e,u as I,b as C,a as q,r as m,g as k,L as j,i as h,_ as g,e as E,h as Q,l as u,q as $}from"./index-gIIwSxQ2.js";const P="https://www.grabfood.life",R=({products:f,onIncrease:n,onDecrease:d,onDeleteFromCart:l})=>e.jsx("div",{className:"w-full",children:f.map(t=>{var o;return e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center hover:bg-gray-100 md:-mx-8 md:px-6 py-5",children:[e.jsxs("div",{className:"flex w-2/5",children:[e.jsx("div",{className:"w-24 hidden md:block ",children:e.jsx("img",{className:"h-24 w-24",src:`${P}/${(o=t.productImage[0])==null?void 0:o.replace(/ /g,"%20")}`,alt:t.name})}),e.jsxs("div",{className:"flex flex-col justify-center ml-4 flex-grow",children:[e.jsx("span",{className:"font-bold text-[12px] md:text-sm mb-2 md:mb-5",children:t.productName}),e.jsxs("span",{className:"text-center block md:hidden mb-2 w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.price.toFixed(2)]}),e.jsx("button",{className:"font-semibold hover:text-red-500 text-gray-500 text-xs w-fit ",onClick:()=>l(t),children:"Remove"})]})]}),e.jsxs("div",{className:"flex justify-center w-1/5",children:[e.jsx("button",{onClick:()=>d(t),children:e.jsx("svg",{className:"fill-current text-gray-600 w-3",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"})})}),e.jsx("input",{className:"mx-2 border text-center w-10",type:"text",value:t.quantity}),e.jsx("button",{onClick:()=>n(t),children:e.jsx("svg",{className:"fill-current text-gray-600 w-3  ",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"})})})]}),e.jsxs("span",{className:"text-center hidden md:block w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.price.toFixed(2)]}),e.jsxs("span",{className:"text-center w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.quantity*t.price]})]})},t._id)})}),D=()=>{const{user:f}=I(s=>s.userReducer),n=f._id,d=C(),l=q(),[t,o]=m.useState([]),[p,v]=m.useState(!0);m.useEffect(()=>{(async()=>{var a,r,i,x;try{const c=await h.get(`/cart/${n}`);o(c.data.cart)}catch(c){console.error("Error fetching cart items:",c),g.error(((r=(a=c.response)==null?void 0:a.data)==null?void 0:r.message)||"An error occurred"),((x=(i=c.response)==null?void 0:i.data)==null?void 0:x.message)==="User is blocked"&&(E.remove("token"),d(Q()),l("/login"))}finally{v(!1)}})()},[n,d,l]),m.useEffect(()=>{t.length>0&&t.forEach(s=>{d(k({name:s.name,productId:s.productId,price:s.price,quantity:s.quantity}))})},[t,d]);const y=async s=>{try{const a=await h.post(`/cart/remove/${n}`,{product:s});u.debug("Remove from cart response:",a.data),a.data.success?(o(a.data.cartItems),u.debug("Cart items after removal:",a.data.cartItems),d($({productId:s.productId}))):console.error("Remove from cart failed:",a.data.message)}catch(a){console.error("Error deleting from cart:",a)}},b=s=>{const r=t.find(i=>i.productId===s.productId);if(r){if(r.quantity+1>5){g.error("Cannot add more than 5 items to the cart.");return}const x=t.map(c=>c.productId===s.productId?{...c,quantity:c.quantity+1}:c);o(x),h.post(`/cart/add/${n}`,{product:s,quantity:1}).then(c=>u.debug("Product added to cart:",c.data)).catch(c=>console.error("Error adding to cart:",c))}},w=s=>{h.post(`/cart/decrease/${n}`,{product:s,quantity:1}).then(r=>u.debug("Product decrease from cart:",r.data)).catch(r=>console.error("Error Product decrease from cart:",r));const a=t.map(r=>r.productId===s.productId?{...r,quantity:Math.max(1,r.quantity-1)}:r);o(a)},N=t.reduce((s,a)=>s+a.price*a.quantity,0);return e.jsx("div",{className:"flex w-full",children:e.jsx("div",{className:"container mx-auto ",children:e.jsx("div",{className:"flex shadow-md ",children:e.jsxs("div",{className:"w-full bg-white px-10 py-10",children:[e.jsxs("div",{className:"flex justify-between border-b pb-8",children:[e.jsx("h1",{className:"font-semibold text-2xl",children:"Shopping Cart"}),e.jsxs("h2",{className:"font-semibold text-2xl",children:[t.length," Items"]})]}),e.jsxs("div",{className:"flex mt-10 mb-5",children:[e.jsx("h3",{className:"font-semibold text-gray-600 text-xs uppercase w-2/5",children:"Product Details"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Quantity"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Price"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Total"})]}),!p&&t.length>0?e.jsx(R,{products:t,onDeleteFromCart:s=>y(s),onIncrease:s=>b(s),onDecrease:s=>w(s)}):e.jsx("p",{children:p?"Loading...":"Your cart is empty"}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:justify-between  border-t ",children:[e.jsx("div",{children:e.jsxs(j,{to:"/menu",className:"flex font-semibold text-indigo-600 text-sm mt-10 w-fit ",children:[e.jsx("svg",{className:"fill-current mr-2 text-indigo-600 w-4",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M134.059 296H436c6.627 0 12-5.373 12-12v-56c0-6.627-5.373-12-12-12H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.569 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296z"})}),"Continue Shopping"]})}),e.jsx("div",{className:"",children:e.jsx("div",{className:" md:w-[320px]   ",children:e.jsxs("div",{className:"flex font-semibold justify-between py- mt-10 text-sm uppercase",children:[e.jsx("span",{className:"text-[12px]",children:"Total cost"}),e.jsxs("span",{children:["₹",N]})]})})})]}),e.jsx("div",{className:"w-full  mt-10 flex justify-end  text-center ",children:(t==null?void 0:t.length)>0&&e.jsx(j,{to:"/checkout",className:"bg-indigo-500 font-semibold w-[300px] hover:bg-indigo-600 py-3 px-3 text-sm text-white uppercase ",children:"Checkout"})})]})})})})};export{D as default};
