import{u as R,a as U,b as M,r as l,i as w,_ as m,f as $,h as z,y as F,z as L,j as s,S as u,M as _,A,B as V,p as B}from"./index-JMqGIfVs.js";const O="https://www.grabfood.life",W=()=>{const{user:n}=R(e=>e.userReducer),i=n==null?void 0:n._id,g=U(),o=M(),[I,x]=l.useState(!0),[c,f]=l.useState(!1),[p,b]=l.useState(!1),[h,j]=l.useState(null),[a,d]=l.useState({name:"",gender:"",email:"",phoneNumber:"",profileImage:""}),N=l.useCallback(async()=>{x(!0);try{const e=await w.get(`/user/get/${i}`);if(e&&e.data){const t=e.data.data;d({name:t.username,gender:t.gender,email:t.email,phoneNumber:t.phone,profileImage:t.profilePicture})}}catch(e){console.error("Error fetching user data:",e),m.error(e.response.data.message),e.response.data.message==="User is blocked"&&($.remove("token"),o(z()),g("/login"))}finally{x(!1)}},[i,g,o]);l.useEffect(()=>{N()},[N]);const v=l.useCallback(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),[]),C=l.useCallback(e=>{const t=/^[0-9]{10}$/,r=/^(\d)\1{9}$/;return t.test(e)?r.test(e)?(m.error("Invalid Phone Number. Phone number should not contain consecutive identical digits."),!1):!0:(m.error("Invalid Phone Number. Please enter a 10-digit number without any spaces or special characters."),!1)},[]),k=l.useCallback(()=>{f(!0)},[]),E=l.useCallback(async()=>{if(!v(a.email)){m.error("Please enter a valid email address.");return}if(C(a.phoneNumber))try{const e=new FormData;e.append("name",a==null?void 0:a.name),e.append("gender",a==null?void 0:a.gender),e.append("email",a==null?void 0:a.email),e.append("phoneNumber",a==null?void 0:a.phoneNumber),h&&e.append("profileImage",h);const t=await w.put(`/user/edit/${i}`,e,{headers:{"Content-Type":"multipart/form-data"}});t.status===200?(console.log("User profile updated successfully"),d(r=>({...r,profileImage:t.data.data.profilePicture})),o(F(t.data.data.profilePicture))):console.error("Error updating user profile"),f(!1)}catch(e){console.error("Error updating user profile:",e)}},[a,h,i,v,C,o]),y=l.useCallback((e,t)=>{if(e==="profileImage"){const r=t[0];j(r)}else d(r=>({...r,[e]:t}))},[]),P=l.useCallback(e=>{j(e),d(t=>({...t,profileImage:URL.createObjectURL(e)}))},[]),S=l.useMemo(()=>typeof a.profileImage=="string"?a.profileImage.startsWith("blob:")?a.profileImage:`${O}/${a.profileImage.replace(/ /g,"%20")}`:L,[a.profileImage]);return s.jsxs("div",{className:"h-full",children:[p&&s.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),s.jsx("div",{className:"container flex flex-col items-center h-full mx-auto p-6 bg-white rounded-md shadow-md",children:s.jsx("div",{className:"flex flex-col justify-center items-center border-2 rounded-[10px] shadow w-[350px] h-[450px] mt-5",children:I?s.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[s.jsx(u,{circle:!0,height:128,width:128}),s.jsx(u,{height:30,width:200,className:"mt-6"}),s.jsx(u,{height:20,width:250,className:"mt-4"}),s.jsx(u,{height:20,width:250,className:"mt-2"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"relative w-32 h-32",children:s.jsx("img",{src:S,alt:"user",className:"w-full h-full object-cover rounded-full"})}),c&&s.jsx("button",{onClick:()=>b(!p),className:"p-1 bg-blue-500 text-white rounded-full",children:"Change Image"}),s.jsx("div",{children:s.jsx("div",{className:"font-semibold text-lg",children:n==null?void 0:n.name})})]}),s.jsxs("div",{className:"mt-6 flex flex-col justify-center items-center",children:[s.jsx("div",{className:"flex items-center mb-4",children:c?s.jsx("input",{type:"email",value:a==null?void 0:a.email,onChange:e=>y("email",e.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"Email"}):s.jsx("span",{children:a==null?void 0:a.email})}),s.jsx("div",{className:"flex w-full justify-center items-center mb-4",children:c?s.jsx("input",{type:"tel",value:a==null?void 0:a.phoneNumber,onChange:e=>y("phoneNumber",e.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",placeholder:"Phone Number"}):s.jsx("span",{children:a==null?void 0:a.phoneNumber})})]}),s.jsx("div",{className:"flex items-center justify-between mt-10",children:c?s.jsxs("div",{className:"flex justify-center items-center gap-10",children:[s.jsxs("button",{onClick:E,className:"text-green-500 hover:underline cursor-pointer",children:[s.jsx(A,{size:20,className:"inline-block mb-1"}),"Save"]}),s.jsxs("button",{onClick:()=>f(!1),className:"text-red-500 hover:underline cursor-pointer",children:[s.jsx(V,{size:20,className:"inline-block mb-1"}),"Cancel"]})]}):s.jsxs("button",{onClick:k,className:"text-blue-500 hover:underline cursor-pointer",children:[s.jsx(_,{size:20,className:"inline-block mb-1"}),"Edit Profile"]})})]})})}),p&&s.jsx(B,{onClose:()=>b(!1),handleImageChange:P,aspectRatio:1/1,maxImage:1})]})};export{W as default};
