import{j as e,u as w,b as C,a as I,r as m,L as f,i,_ as p,e as k,q}from"./index-SiLwYWCA.js";const E="http://localhost:5000",Q=({products:l,onIncrease:n,onDecrease:d,onDeleteFromCart:x})=>(console.log(l),e.jsx("div",{className:"w-full",children:l.map(t=>{var o;return e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center hover:bg-gray-100 md:-mx-8 md:px-6 py-5",children:[e.jsxs("div",{className:"flex w-2/5",children:[e.jsx("div",{className:"w-24 hidden md:block ",children:e.jsx("img",{className:"h-24 w-24",src:`${E}/${(o=t.productImage[0])==null?void 0:o.replace(/ /g,"%20")}`,alt:t.name})}),e.jsxs("div",{className:"flex flex-col justify-center ml-4 flex-grow",children:[e.jsx("span",{className:"font-bold text-[12px] md:text-sm mb-2 md:mb-5",children:t.productName}),e.jsxs("span",{className:"text-center block md:hidden mb-2 w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.price.toFixed(2)]}),e.jsx("button",{className:"font-semibold hover:text-red-500 text-gray-500 text-xs w-fit ",onClick:()=>x(t),children:"Remove"})]})]}),e.jsxs("div",{className:"flex justify-center w-1/5",children:[e.jsx("button",{onClick:()=>d(t),children:e.jsx("svg",{className:"fill-current text-gray-600 w-3",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"})})}),e.jsx("input",{className:"mx-2 border text-center w-10",type:"text",value:t.quantity}),e.jsx("button",{onClick:()=>n(t),children:e.jsx("svg",{className:"fill-current text-gray-600 w-3  ",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"})})})]}),e.jsxs("span",{className:"text-center hidden md:block w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.price.toFixed(2)]}),e.jsxs("span",{className:"text-center w-1/5 font-semibold text-[12px] md:text-sm",children:["₹",t.quantity*t.price]})]})},t._id)})})),P=()=>{const{user:l}=w(s=>s.userReducer),n=l._id,d=C(),x=I(),[t,o]=m.useState([]),[h,j]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const a=await i.get(`/cart/${n}`);o(a.data.cart)}catch(a){console.error("Error fetching cart items:",a),p.error(a.response.data.message),a.response.data.message==="User is blocked"&&(k.remove("token"),d(q()),x("/login"))}finally{j(!1)}})()},[n]),console.log(t);const g=async s=>{try{const a=await i.post(`/cart/remove/${n}`,{product:s});console.log("Remove from cart response:",a.data),a.data.success?(console.log(a.data),o(a.data.cartItems),console.log("Cart items after removal:",a.data.cartItems),console.log("done")):console.error("Remove from cart failed:",a.data.message)}catch(a){console.error("Error deleting from cart:",a)}},v=s=>{console.log(s.productId);const c=t.find(u=>u.productId===s.productId);if(c){if(c.quantity+1>5){p.error("Cannot add more than 5 items to the cart.");return}const N=t.map(r=>r.productId===s.productId?{...r,quantity:r.quantity+1}:r);o(N),i.post(`/cart/add/${n}`,{product:s,quantity:1}).then(r=>console.log("Product added to cart:",r.data)).catch(r=>console.error("Error adding to cart:",r))}},y=s=>{i.post(`/cart/decrease/${n}`,{product:s,quantity:1}).then(c=>console.log("Product decrease from cart:",c.data)).catch(c=>console.error("Error Product decrease from cart:",c));const a=t.map(c=>c.productId===s.productId?{...c,quantity:Math.max(1,c.quantity-1)}:c);o(a)},b=t.reduce((s,a)=>s+a.price*a.quantity,0);return e.jsx("div",{className:"flex w-full",children:e.jsx("div",{className:"container mx-auto ",children:e.jsx("div",{className:"flex shadow-md ",children:e.jsxs("div",{className:"w-full bg-white px-10 py-10",children:[e.jsxs("div",{className:"flex justify-between border-b pb-8",children:[e.jsx("h1",{className:"font-semibold text-2xl",children:"Shopping Cart"}),e.jsxs("h2",{className:"font-semibold text-2xl",children:[t.length," Items"]})]}),e.jsxs("div",{className:"flex mt-10 mb-5",children:[e.jsx("h3",{className:"font-semibold text-gray-600 text-xs uppercase w-2/5",children:"Product Details"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Quantity"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Price"}),e.jsx("h3",{className:"font-semibold  text-gray-600 text-xs uppercase w-1/5 text-center",children:"Total"})]}),!h&&t.length>0?e.jsx(Q,{products:t,onDeleteFromCart:s=>g(s),onIncrease:s=>v(s),onDecrease:s=>y(s)}):e.jsx("p",{children:h?"Loading...":"Your cart is empty"}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:justify-between  border-t ",children:[e.jsx("div",{children:e.jsxs(f,{to:"/menu",className:"flex font-semibold text-indigo-600 text-sm mt-10 w-fit ",children:[e.jsx("svg",{className:"fill-current mr-2 text-indigo-600 w-4",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M134.059 296H436c6.627 0 12-5.373 12-12v-56c0-6.627-5.373-12-12-12H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.569 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296z"})}),"Continue Shopping"]})}),e.jsx("div",{className:"",children:e.jsx("div",{className:" md:w-[320px]   ",children:e.jsxs("div",{className:"flex font-semibold justify-between py- mt-10 text-sm uppercase",children:[e.jsx("span",{className:"text-[12px]",children:"Total cost"}),e.jsxs("span",{children:["₹",b]})]})})})]}),e.jsx("div",{className:"w-full  mt-10 flex justify-end  text-center ",children:(t==null?void 0:t.length)>0&&e.jsx(f,{to:"/checkout",className:"bg-indigo-500 font-semibold w-[300px] hover:bg-indigo-600 py-3 px-3 text-sm text-white uppercase ",children:"Checkout"})})]})})})})};export{P as default};
