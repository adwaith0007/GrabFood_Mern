import{u as P,a as R,b as U,r as n,y as M,j as e,S as c,M as $,z,A as F,p as L,i as N,_ as p,e as _,h as A,B as V}from"./index-L-aEWsx6.js";const B="https://www.grabfood.life",T=()=>{const{user:l}=P(t=>t.userReducer),d=l==null?void 0:l._id,v=R(),f=U(),[y,h]=n.useState(!0),[i,m]=n.useState(!1),[u,g]=n.useState(!1),[x,b]=n.useState(null),[s,o]=n.useState({name:"",gender:"",email:"",phoneNumber:"",profileImage:""});n.useEffect(()=>{(async()=>{h(!0);try{const a=await N.get(`/user/get/${d}`);if(a&&a.data){const r=a.data.data;o({name:r.username,gender:r.gender,email:r.email,phoneNumber:r.phone,profileImage:r.profilePicture})}}catch(a){console.error("Error fetching user data:",a),p.error(a.response.data.message),a.response.data.message==="User is blocked"&&(_.remove("token"),f(A()),v("/login"))}finally{h(!1)}})()},[d]);const w=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),I=t=>/^[0-9]{10}$/.test(t),C=()=>{m(!0)},E=async()=>{if(!w(s.email)){p.error("Please enter a valid email address.");return}if(!I(s.phoneNumber)){p.error("Please enter a valid 10-digit phone number.");return}try{const t=new FormData;t.append("name",s==null?void 0:s.name),t.append("gender",s==null?void 0:s.gender),t.append("email",s==null?void 0:s.email),t.append("phoneNumber",s==null?void 0:s.phoneNumber),x&&t.append("profileImage",x);const a=await N.put(`/user/edit/${d}`,t,{headers:{"Content-Type":"multipart/form-data"}});a.status===200?(console.log("User profile updated successfully"),o(r=>({...r,profileImage:a.data.data.profilePicture})),f(V(a.data.data.profilePicture))):console.error("Error updating user profile"),m(!1)}catch(t){console.error("Error updating user profile:",t)}},j=(t,a)=>{if(t==="profileImage"){const r=a[0];b(r)}else o({...s,[t]:a})},k=t=>{b(t),o(a=>({...a,profileImage:URL.createObjectURL(t)}))},S=typeof s.profileImage=="string"?s.profileImage.startsWith("blob:")?s.profileImage:`${B}/${s.profileImage.replace(/ /g,"%20")}`:M;return e.jsxs("div",{className:"h-full",children:[u&&e.jsx("div",{className:"bg-gray-500/80 fixed w-full h-screen z-20 top-0 left-0"}),e.jsx("div",{className:"container flex flex-col items-center h-full mx-auto p-6 bg-white rounded-md shadow-md",children:e.jsx("div",{className:"flex flex-col justify-center items-center border-2 rounded-[10px] shadow w-[350px] h-[450px] mt-5",children:y?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[e.jsx(c,{circle:!0,height:128,width:128}),e.jsx(c,{height:30,width:200,className:"mt-6"}),e.jsx(c,{height:20,width:250,className:"mt-4"}),e.jsx(c,{height:20,width:250,className:"mt-2"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"relative w-32 h-32",children:e.jsx("img",{src:S,alt:"user",className:"w-full h-full object-cover rounded-full"})}),i&&e.jsx("button",{onClick:()=>g(!u),className:"p-1 bg-blue-500 text-white rounded-full",children:"Change Image"}),e.jsx("div",{children:e.jsx("div",{className:"font-semibold text-lg",children:l==null?void 0:l.name})})]}),e.jsxs("div",{className:"mt-6 flex flex-col justify-center items-center",children:[e.jsx("div",{className:"flex items-center mb-4",children:i?e.jsx("input",{type:"email",value:s==null?void 0:s.email,onChange:t=>j("email",t.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"Email"}):e.jsx("span",{children:s==null?void 0:s.email})}),e.jsx("div",{className:"flex w-full justify-center items-center mb-4",children:i?e.jsx("input",{type:"tel",value:s==null?void 0:s.phoneNumber,onChange:t=>j("phoneNumber",t.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",placeholder:"Phone Number"}):e.jsx("span",{children:s==null?void 0:s.phoneNumber})})]}),e.jsx("div",{className:"flex items-center justify-between mt-10",children:i?e.jsxs("div",{className:"flex justify-center items-center gap-10",children:[e.jsxs("button",{onClick:E,className:"text-green-500 hover:underline cursor-pointer",children:[e.jsx(z,{size:20,className:"inline-block mb-1"}),"Save"]}),e.jsxs("button",{onClick:()=>m(!1),className:"text-red-500 hover:underline cursor-pointer",children:[e.jsx(F,{size:20,className:"inline-block mb-1"}),"Cancel"]})]}):e.jsxs("button",{onClick:C,className:"text-blue-500 hover:underline cursor-pointer",children:[e.jsx($,{size:20,className:"inline-block mb-1"}),"Edit Profile"]})})]})})}),u&&e.jsx(L,{onClose:()=>g(!1),handleImageChange:k,aspectRatio:1/1,maxImage:1})]})};export{T as default};
